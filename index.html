<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FITNESS DUO</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        
        :root { 
            --bg: #020617; 
            --card: #0f172a; 
            --text: #f1f5f9; 
            --primary: #f472b6; /* Rose (Samia) */
            --primary-dim: rgba(244, 114, 182, 0.1);
        }

        body.theme-quincy { --primary: #38bdf8; --primary-dim: rgba(56, 189, 248, 0.1); }

        body { font-family: 'Outfit', sans-serif; background-color: var(--bg); color: var(--text); height: 100dvh; overflow: hidden; display: flex; flex-direction: column; }
        
        .safe-pt { padding-top: max(env(safe-area-inset-top), 20px); }
        .safe-pb { padding-bottom: max(env(safe-area-inset-bottom), 90px); }
        
        .view-container { 
            flex: 1; 
            overflow-y: auto; 
            padding-bottom: 200px !important; 
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch; 
        }
        
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .card { background: linear-gradient(145deg, rgba(30, 41, 59, 0.4) 0%, rgba(15, 23, 42, 0.6) 100%); border: 1px solid rgba(255,255,255,0.05); border-radius: 24px; }
        
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .cal-day { 
            aspect-ratio: 1/1.1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 4px;
            border-radius: 10px; font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.4);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.02); background: rgba(255,255,255,0.02);
            position: relative; overflow: hidden;
        }
        .cal-selected { border-color: var(--primary) !important; color: #fff !important; background: var(--primary-dim) !important; }
        .cal-today { color: var(--primary); text-decoration: underline; text-underline-offset: 2px; }
        
        .plan-badge {
            margin-top: 2px; font-size: 7px; text-transform: uppercase; background: var(--primary); color: #000;
            padding: 1px 4px; border-radius: 4px; max-width: 90%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 800; opacity: 0.9;
        }

        /* Inputs g√©n√©raux */
        input, select { background: rgba(0,0,0,0.3) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; outline: none; border-radius: 12px; }
        input:focus, select:focus { border-color: var(--primary) !important; }
        
        /* CORRECTION IOS TIME INPUT */
        input[type="time"] {
            appearance: none; -webkit-appearance: none;
            background: rgba(255,255,255,0.08) !important; /* Fond l√©ger pour voir la zone */
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: white; 
            font-weight: 700; 
            font-size: 14px;
            padding: 6px 10px; 
            text-align: center;
            border-radius: 8px;
            min-width: 80px; /* Largeur forc√©e pour le doigt */
            display: inline-block;
        }
        /* Force l'ic√¥ne blanche ou invisible mais cliquable */
        input[type="time"]::-webkit-calendar-picker-indicator { 
            filter: invert(1); 
            opacity: 0.6;
        }

        .nav-item { transition: all 0.3s; position: relative; }
        .nav-active { color: var(--primary); opacity: 1 !important; transform: translateY(-5px); }
        .nav-active::after { content: ''; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); width: 20px; height: 20px; background: var(--primary); filter: blur(15px); border-radius: 50%; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .anim-entry { animation: fadeUp 0.4s ease-out forwards; }
    </style>
</head>
<body class="theme-samia">

    <header class="glass sticky top-0 z-40 safe-pt pb-4">
        <div class="px-6 flex flex-col gap-4">
            <div class="flex items-center justify-between">
                <div class="flex gap-2 p-1 bg-white/5 rounded-full border border-white/5">
                    <button onclick="switchUser('samia')" id="btn-samia" class="px-4 py-2 rounded-full text-xs font-black uppercase transition-all flex items-center gap-2">
                        üë©üèΩ Samia
                    </button>
                    <button onclick="switchUser('quincy')" id="btn-quincy" class="px-4 py-2 rounded-full text-xs font-black uppercase transition-all flex items-center gap-2 opacity-50">
                        üßîüèæ‚Äç‚ôÇÔ∏è Quincy
                    </button>
                </div>
                <div class="text-[10px] uppercase font-bold tracking-widest opacity-50" id="date-display">...</div>
            </div>
        </div>
    </header>

    <main class="view-container p-5 space-y-6">

        <section id="view-dashboard" class="space-y-6 anim-entry">
            
            <div class="card p-4">
                <div class="flex justify-between items-center mb-4 px-2">
                    <button onclick="changeMonth(-1)" class="text-xl opacity-50 hover:opacity-100 p-2">‚Üê</button>
                    <h2 id="month-name" class="text-sm font-black uppercase tracking-[0.2em]"></h2>
                    <button onclick="changeMonth(1)" class="text-xl opacity-50 hover:opacity-100 p-2">‚Üí</button>
                </div>
                <div id="calendar-grid" class="cal-grid"></div>
                <div class="mt-4 pt-4 border-t border-white/5 flex items-center justify-between">
                    <div>
                        <div class="text-[9px] font-black uppercase opacity-40">S√©ance pr√©vue le <span id="lbl-selected-date"></span></div>
                        <div id="current-plan-display" class="text-sm font-bold mt-1 text-white/80 italic">Repos / Rien pr√©vu</div>
                    </div>
                    <button onclick="openPlanModal()" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase text-black transition hover:scale-105" style="background: var(--primary)">
                        ‚ûï Planifier
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                
                <div class="card p-4 relative overflow-hidden flex flex-col justify-between">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[9px] font-black uppercase opacity-60">Sommeil</span>
                        <span class="text-xl">üåô</span>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-[8px] opacity-50 uppercase mr-2">Coucher</span>
                            <input type="time" id="sleep-start" onchange="calcSleep()" onclick="this.showPicker()">
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-[8px] opacity-50 uppercase mr-2">Lever</span>
                            <input type="time" id="sleep-end" onchange="calcSleep()" onclick="this.showPicker()">
                        </div>
                    </div>

                    <div class="mt-3 pt-2 border-t border-white/5 text-center">
                        <span id="sleep-total" class="text-xl font-black text-white block">--h--</span>
                    </div>
                </div>

                <div class="card p-4 relative overflow-hidden flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <span class="text-[9px] font-black uppercase opacity-60">Activit√©</span>
                        <span class="text-xl">üë£</span>
                    </div>
                    <div class="flex items-center gap-2 mt-4">
                        <input type="number" id="in-steps" placeholder="-" class="w-full p-2 text-center font-black bg-transparent border-b border-white/20 rounded-xl focus:border-white text-xl" onchange="saveSteps()">
                    </div>
                    <div class="text-[8px] uppercase font-bold opacity-40 text-center mt-1">Pas / jour</div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div onclick="addWater()" class="card p-4 relative overflow-hidden group active:scale-95 transition cursor-pointer">
                    <div class="absolute -right-4 -bottom-4 text-6xl opacity-10 group-hover:scale-110 transition">üíß</div>
                    <span class="text-[9px] font-black uppercase opacity-60">Hydratation</span>
                    <div class="flex items-end gap-1 mt-1">
                        <span class="text-3xl font-black" id="val-water">0</span>
                        <span class="text-xs font-bold opacity-60 mb-1">Gourdes</span>
                    </div>
                    <div class="w-full bg-white/10 h-1 mt-3 rounded-full overflow-hidden">
                        <div id="prog-water" class="h-full bg-blue-500 w-0 transition-all duration-500"></div>
                    </div>
                </div>
                <div class="card p-4 relative overflow-hidden">
                    <div class="absolute -right-4 -bottom-4 text-6xl opacity-10">üî•</div>
                    <span class="text-[9px] font-black uppercase opacity-60">Volume Sport</span>
                    <div class="flex items-end gap-1 mt-1">
                        <span class="text-3xl font-black" id="val-vol">0</span>
                        <span class="text-xs font-bold opacity-60 mb-1">kg</span>
                    </div>
                    <p class="text-[9px] mt-2 opacity-50" id="val-cardio-sum">0 min cardio</p>
                </div>
            </div>

            <div class="card p-5 space-y-4">
                <h3 class="text-[10px] font-black uppercase tracking-widest opacity-40 mb-2">Macronutriments</h3>
                <div>
                    <div class="flex justify-between text-[10px] font-bold mb-1">
                        <span>Calories</span>
                        <span id="txt-cals" style="color:var(--primary)">0 / 2000</span>
                    </div>
                    <div class="w-full bg-slate-950 h-3 rounded-full overflow-hidden border border-white/5">
                        <div id="bar-cals" class="h-full w-0 transition-all duration-700" style="background: var(--primary)"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-[10px] font-bold mb-1">
                        <span>Prot√©ines</span>
                        <span id="txt-prot" class="text-emerald-400">0 / 140g</span>
                    </div>
                    <div class="w-full bg-slate-950 h-3 rounded-full overflow-hidden border border-white/5">
                        <div id="bar-prot" class="h-full bg-emerald-500 w-0 transition-all duration-700"></div>
                    </div>
                </div>
            </div>
            
            <div class="h-32 w-full"></div>
        </section>

        <section id="view-sport" class="hidden space-y-6 anim-entry">
            <div class="flex bg-slate-900 p-1 rounded-2xl border border-white/5">
                <button onclick="setSportType('muscu')" id="btn-type-muscu" class="flex-1 py-3 rounded-xl text-[10px] font-black uppercase bg-white/10 transition">üèãÔ∏è Muscu</button>
                <button onclick="setSportType('cardio')" id="btn-type-cardio" class="flex-1 py-3 rounded-xl text-[10px] font-black uppercase opacity-40 transition">üèÉ Cardio</button>
            </div>

            <div id="form-muscu" class="card p-5 space-y-3 border-t-4" style="border-top-color: var(--primary)">
                <input type="text" id="m-name" placeholder="Nom de l'exercice (ex: Squat)" class="w-full p-3 font-bold text-sm uppercase">
                <select id="m-type" class="w-full p-3 text-xs font-bold uppercase text-gray-400">
                    <option value="Constante">üîÅ Charge Constante</option>
                    <option value="Progressive">üìà Charge Progressive</option>
                    <option value="D√©gressive">üìâ D√©gressive (Drop Set)</option>
                </select>
                <div class="grid grid-cols-2 gap-3">
                    <div class="relative">
                        <input type="number" id="m-weight" placeholder="0" class="w-full p-3 text-center font-bold">
                        <span class="absolute right-3 top-3 text-xs font-black opacity-30">KG</span>
                    </div>
                    <div class="relative">
                        <input type="number" id="m-reps" placeholder="0" class="w-full p-3 text-center font-bold">
                        <span class="absolute right-3 top-3 text-xs font-black opacity-30">REPS</span>
                    </div>
                </div>
                <button onclick="addSport('muscu')" class="w-full py-4 rounded-xl font-black uppercase text-xs shadow-lg active:scale-95 transition" style="background: var(--primary); color: #000;">Valider la s√©rie</button>
            </div>

            <div id="form-cardio" class="hidden card p-5 space-y-3 border-t-4 border-orange-500">
                <input type="text" id="c-name" placeholder="Activit√© (ex: Tapis, V√©lo)" class="w-full p-3 font-bold text-sm uppercase">
                <div class="grid grid-cols-2 gap-3">
                    <div class="relative">
                        <input type="number" id="c-time" placeholder="0" class="w-full p-3 text-center font-bold">
                        <span class="absolute right-3 top-3 text-xs font-black opacity-30">MIN</span>
                    </div>
                    <div class="relative">
                        <input type="number" id="c-dist" placeholder="0" class="w-full p-3 text-center font-bold">
                        <span class="absolute right-3 top-3 text-xs font-black opacity-30">KM</span>
                    </div>
                </div>
                <button onclick="addSport('cardio')" class="w-full py-4 rounded-xl font-black uppercase text-xs shadow-lg bg-orange-500 text-black active:scale-95 transition">Valider la s√©ance</button>
            </div>

            <div class="space-y-3">
                <h3 class="text-[10px] font-black uppercase tracking-widest opacity-40 text-center">S√©ance du jour</h3>
                <div id="list-sport" class="space-y-2 pb-10"></div>
            </div>
            <div class="h-32 w-full"></div>
        </section>

        <section id="view-food" class="hidden space-y-6 anim-entry">
            <div class="card p-5 space-y-3 border-t-4 border-emerald-500">
                <h3 class="text-sm font-black uppercase flex items-center gap-2"><span class="text-xl">ü•ó</span> Ajouter un repas</h3>
                <input type="text" id="f-name" placeholder="Qu'as-tu mang√© ?" class="w-full p-3 font-bold text-sm">
                <div class="grid grid-cols-2 gap-3">
                    <div class="relative">
                        <input type="number" id="f-cal" placeholder="0" class="w-full p-3 text-center font-bold">
                        <span class="absolute right-3 top-3 text-xs font-black opacity-30">KCAL</span>
                    </div>
                    <div class="relative">
                        <input type="number" id="f-prot" placeholder="0" class="w-full p-3 text-center font-bold">
                        <span class="absolute right-3 top-3 text-xs font-black opacity-30">PROT</span>
                    </div>
                </div>
                <button onclick="addFood()" class="w-full py-4 rounded-xl font-black uppercase text-xs shadow-lg bg-emerald-500 text-black active:scale-95 transition">Miam !</button>
            </div>

            <div class="space-y-3">
                <h3 class="text-[10px] font-black uppercase tracking-widest opacity-40 text-center">Repas du jour</h3>
                <div id="list-food" class="space-y-2 pb-10"></div>
            </div>
            <div class="h-32 w-full"></div>
        </section>

        <section id="view-body" class="hidden space-y-6 anim-entry">
            <div class="card p-5 space-y-4">
                <h3 class="text-sm font-black uppercase flex items-center gap-2"><span class="text-xl">üìè</span> Mensurations</h3>
                <div class="space-y-3">
                    <label class="text-[10px] font-bold uppercase opacity-60">Poids (kg)</label>
                    <input type="number" id="b-weight" class="w-full p-3 font-bold">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] font-bold uppercase opacity-60">Taille (cm)</label>
                            <input type="number" id="b-waist" placeholder="Taille" class="w-full p-3 font-bold">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold uppercase opacity-60">Hanches (cm)</label>
                            <input type="number" id="b-glutes" placeholder="Fessier" class="w-full p-3 font-bold">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold uppercase opacity-60">Bras (cm)</label>
                            <input type="number" id="b-arms" placeholder="Bras" class="w-full p-3 font-bold">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold uppercase opacity-60">Cuisses (cm)</label>
                            <input type="number" id="b-thighs" placeholder="Cuisses" class="w-full p-3 font-bold">
                        </div>
                    </div>
                </div>
                <button onclick="saveBody()" class="w-full py-4 rounded-xl font-black uppercase text-xs shadow-lg active:scale-95 transition" style="background: var(--primary); color: #000;">Enregistrer</button>
            </div>

            <div class="space-y-2">
                <h3 class="text-[10px] font-black uppercase tracking-widest opacity-40 text-center">Derni√®res mesures</h3>
                <div id="list-body" class="space-y-2 pb-10"></div>
            </div>
            <div class="h-32 w-full"></div>
        </section>

    </main>

    <div id="plan-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-slate-900 w-full max-w-xs rounded-3xl p-6 border border-white/10 shadow-2xl">
            <h4 class="text-xs font-black uppercase tracking-widest text-center mb-4 opacity-60">Planifier le <span id="modal-date-display"></span></h4>
            <input type="text" id="plan-input" placeholder="Ex: Leg Day, Cardio, Repos..." class="w-full p-4 rounded-xl mb-4 font-bold uppercase text-sm text-center border-white/20">
            <div class="flex flex-wrap gap-2 justify-center mb-6">
                <button onclick="fillPlan('LEG DAY')" class="bg-white/5 px-3 py-1 rounded-full text-[10px] font-bold border border-white/10">LEG DAY</button>
                <button onclick="fillPlan('PUSH')" class="bg-white/5 px-3 py-1 rounded-full text-[10px] font-bold border border-white/10">PUSH</button>
                <button onclick="fillPlan('PULL')" class="bg-white/5 px-3 py-1 rounded-full text-[10px] font-bold border border-white/10">PULL</button>
                <button onclick="fillPlan('CARDIO')" class="bg-white/5 px-3 py-1 rounded-full text-[10px] font-bold border border-white/10">CARDIO</button>
                <button onclick="fillPlan('REPOS')" class="bg-white/5 px-3 py-1 rounded-full text-[10px] font-bold border border-white/10">REPOS</button>
            </div>
            <div class="flex gap-2">
                <button onclick="closePlanModal()" class="flex-1 py-3 opacity-50 font-bold text-[10px] uppercase">Annuler</button>
                <button onclick="savePlan()" class="flex-1 rounded-xl font-bold text-[10px] uppercase shadow-lg" style="background: var(--primary); color: black;">Valider</button>
            </div>
        </div>
    </div>

    <nav class="glass fixed bottom-0 w-full z-50 safe-pb border-t border-white/5">
        <div class="grid grid-cols-4 py-2">
            <button onclick="nav('dashboard', this)" class="nav-item nav-active flex flex-col items-center p-2">
                <span class="text-xl mb-1">üìÖ</span>
                <span class="text-[8px] font-black uppercase">Dash</span>
            </button>
            <button onclick="nav('sport', this)" class="nav-item flex flex-col items-center opacity-40 p-2">
                <span class="text-xl mb-1">üí™</span>
                <span class="text-[8px] font-black uppercase">Sport</span>
            </button>
            <button onclick="nav('food', this)" class="nav-item flex flex-col items-center opacity-40 p-2">
                <span class="text-xl mb-1">ü•ë</span>
                <span class="text-[8px] font-black uppercase">Nutri</span>
            </button>
            <button onclick="nav('body', this)" class="nav-item flex flex-col items-center opacity-40 p-2">
                <span class="text-xl mb-1">üìè</span>
                <span class="text-[8px] font-black uppercase">Body</span>
            </button>
        </div>
    </nav>

    <script>
        let curUser = 'samia';
        const usersConfig = {
            samia: { theme: 'theme-samia', cals: 2100, prot: 130 },
            quincy: { theme: 'theme-quincy', cals: 2600, prot: 180 }
        };
        
        let db = JSON.parse(localStorage.getItem('fit_duo_v4')) || { 
            samia: { sport:[], food:[], body:[], water:{}, planning:{}, steps:{}, sleep:{} }, 
            quincy: { sport:[], food:[], body:[], water:{}, planning:{}, steps:{}, sleep:{} } 
        };

        let curMonth = new Date();
        let selDate = new Date().toISOString().split('T')[0];
        const today = new Date().toISOString().split('T')[0];
        let sportType = 'muscu';

        function save() { localStorage.setItem('fit_duo_v4', JSON.stringify(db)); render(); }

        function switchUser(u) {
            curUser = u;
            document.body.className = usersConfig[u].theme;
            document.getElementById('btn-samia').style.opacity = u === 'samia' ? '1' : '0.5';
            document.getElementById('btn-samia').style.background = u === 'samia' ? '#ffffff20' : 'transparent';
            document.getElementById('btn-quincy').style.opacity = u === 'quincy' ? '1' : '0.5';
            document.getElementById('btn-quincy').style.background = u === 'quincy' ? '#ffffff20' : 'transparent';
            render();
        }

        function nav(view, btn) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-' + view).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => { n.classList.remove('nav-active'); n.classList.add('opacity-40'); });
            btn.classList.add('nav-active'); btn.classList.remove('opacity-40');
        }

        function setSportType(t) {
            sportType = t;
            document.getElementById('form-muscu').classList.add('hidden');
            document.getElementById('form-cardio').classList.add('hidden');
            document.getElementById('btn-type-muscu').className = t==='muscu' ? 'flex-1 py-3 rounded-xl text-[10px] font-black uppercase bg-white/10 transition' : 'flex-1 py-3 rounded-xl text-[10px] font-black uppercase opacity-40 transition';
            document.getElementById('btn-type-cardio').className = t==='cardio' ? 'flex-1 py-3 rounded-xl text-[10px] font-black uppercase bg-white/10 transition' : 'flex-1 py-3 rounded-xl text-[10px] font-black uppercase opacity-40 transition';
            document.getElementById('form-' + t).classList.remove('hidden');
        }

        function selectDay(d) { selDate = d; render(); }
        function changeMonth(v) { curMonth.setMonth(curMonth.getMonth() + v); render(); }

        function openPlanModal() {
            document.getElementById('modal-date-display').innerText = selDate;
            document.getElementById('plan-input').value = db[curUser].planning[selDate] || "";
            document.getElementById('plan-modal').classList.remove('hidden');
            document.getElementById('plan-input').focus();
        }
        function closePlanModal() { document.getElementById('plan-modal').classList.add('hidden'); }
        function fillPlan(txt) { document.getElementById('plan-input').value = txt; }
        function savePlan() {
            const val = document.getElementById('plan-input').value;
            if(val) db[curUser].planning[selDate] = val;
            else delete db[curUser].planning[selDate];
            save(); closePlanModal();
        }

        function addWater() { db[curUser].water[selDate] = (db[curUser].water[selDate] || 0) + 1; save(); }
        
        function calcSleep() {
            const s = document.getElementById('sleep-start').value;
            const e = document.getElementById('sleep-end').value;
            if(s && e) {
                let d1 = new Date("2000-01-01 " + s);
                let d2 = new Date("2000-01-01 " + e);
                if (d2 < d1) d2.setDate(d2.getDate() + 1);
                const diff = d2 - d1;
                const hours = Math.floor(diff / 1000 / 60 / 60);
                const minutes = Math.floor((diff / 1000 / 60) % 60);
                const formatted = `${hours}h${String(minutes).padStart(2, '0')}`;
                db[curUser].sleep[selDate] = { start: s, end: e, total: formatted };
                save();
            }
        }
        
        function saveSteps() {
            db[curUser].steps[selDate] = document.getElementById('in-steps').value;
            save();
        }

        function addSport(type) {
            const data = { d: selDate, id: Date.now(), type: type };
            if(type === 'muscu') {
                data.name = document.getElementById('m-name').value; data.set = document.getElementById('m-type').value;
                data.w = parseFloat(document.getElementById('m-weight').value)||0; data.r = parseFloat(document.getElementById('m-reps').value)||0;
                if(!data.name) return;
                document.getElementById('m-reps').value = '';
            } else {
                data.name = document.getElementById('c-name').value;
                data.time = parseFloat(document.getElementById('c-time').value)||0; data.dist = parseFloat(document.getElementById('c-dist').value)||0;
                if(!data.name) return;
                document.getElementById('c-name').value = ''; document.getElementById('c-time').value = '';
            }
            db[curUser].sport.unshift(data); save();
        }
        function addFood() {
            const n = document.getElementById('f-name').value;
            const k = parseInt(document.getElementById('f-cal').value)||0; const p = parseInt(document.getElementById('f-prot').value)||0;
            if(!n) return;
            db[curUser].food.unshift({ n, k, p, d: selDate, id: Date.now() });
            document.getElementById('f-name').value=''; document.getElementById('f-cal').value=''; document.getElementById('f-prot').value=''; save();
        }
        function saveBody() {
            db[curUser].body.unshift({
                d: selDate, w: document.getElementById('b-weight').value, waist: document.getElementById('b-waist').value,
                glutes: document.getElementById('b-glutes').value, arms: document.getElementById('b-arms').value, thighs: document.getElementById('b-thighs').value
            }); save();
        }
        function deleteItem(type, id) { if(confirm("Supprimer ?")) { db[curUser][type] = db[curUser][type].filter(x => x.id !== id); save(); } }

        function render() {
            const userData = db[curUser];
            const daySport = userData.sport.filter(x => x.d === selDate);
            const dayFood = userData.food.filter(x => x.d === selDate);
            const userConf = usersConfig[curUser];

            const dObj = new Date(selDate);
            document.getElementById('date-display').innerText = dObj.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
            document.getElementById('lbl-selected-date').innerText = dObj.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
            
            const totalCals = dayFood.reduce((a,b)=>a+b.k, 0);
            const totalProt = dayFood.reduce((a,b)=>a+b.p, 0);
            const waterCount = userData.water[selDate] || 0;
            const planText = userData.planning[selDate] || "Rien de pr√©vu";

            document.getElementById('in-steps').value = userData.steps ? (userData.steps[selDate] || "") : "";
            
            const daySleep = userData.sleep ? userData.sleep[selDate] : null;
            if (daySleep && typeof daySleep === 'object') {
                document.getElementById('sleep-start').value = daySleep.start || "";
                document.getElementById('sleep-end').value = daySleep.end || "";
                document.getElementById('sleep-total').innerText = daySleep.total || "--h--";
            } else {
                document.getElementById('sleep-start').value = "";
                document.getElementById('sleep-end').value = "";
                document.getElementById('sleep-total').innerText = "--h--";
            }

            document.getElementById('val-water').innerText = waterCount;
            document.getElementById('prog-water').style.width = Math.min((waterCount/8)*100, 100) + '%';
            document.getElementById('txt-cals').innerText = `${totalCals} / ${userConf.cals}`;
            document.getElementById('bar-cals').style.width = Math.min((totalCals/userConf.cals)*100, 100) + '%';
            document.getElementById('txt-prot').innerText = `${totalProt} / ${userConf.prot}g`;
            document.getElementById('bar-prot').style.width = Math.min((totalProt/userConf.prot)*100, 100) + '%';
            document.getElementById('current-plan-display').innerText = planText;
            document.getElementById('current-plan-display').style.opacity = userData.planning[selDate] ? '1' : '0.4';
            document.getElementById('current-plan-display').style.fontStyle = userData.planning[selDate] ? 'normal' : 'italic';

            const vol = daySport.filter(x=>x.type==='muscu').reduce((a,b)=>a+(b.w*b.r), 0);
            const car = daySport.filter(x=>x.type==='cardio').reduce((a,b)=>a+b.time, 0);
            document.getElementById('val-vol').innerText = vol > 1000 ? (vol/1000).toFixed(1)+'k' : vol;
            document.getElementById('val-cardio-sum').innerText = `${car} min cardio`;

            const mNames = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"];
            document.getElementById('month-name').innerText = mNames[curMonth.getMonth()] + " " + curMonth.getFullYear();
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = "";
            const firstDay = new Date(curMonth.getFullYear(), curMonth.getMonth(), 1).getDay();
            const daysInMonth = new Date(curMonth.getFullYear(), curMonth.getMonth() + 1, 0).getDate();
            const offset = firstDay === 0 ? 6 : firstDay - 1;

            for(let i=0; i<offset; i++) grid.innerHTML += `<div></div>`;
            for(let d=1; d<=daysInMonth; d++) {
                const dateStr = `${curMonth.getFullYear()}-${String(curMonth.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const isSel = dateStr === selDate ? 'cal-selected' : '';
                const isTod = dateStr === today ? 'cal-today' : '';
                const dayPlan = userData.planning[dateStr] ? `<div class="plan-badge">${userData.planning[dateStr]}</div>` : '';

                grid.innerHTML += `<div onclick="selectDay('${dateStr}')" class="cal-day ${isSel} ${isTod}"><span>${d}</span>${dayPlan}</div>`;
            }

            document.getElementById('list-sport').innerHTML = daySport.map(s => {
                if(s.type === 'muscu') {
                    return `<div class="card p-3 flex justify-between items-center text-xs relative group"><div><span class="font-black uppercase text-[10px] opacity-50 block">${s.set}</span><span class="font-bold uppercase text-sm">${s.name}</span></div><div class="text-right"><div class="font-black text-lg" style="color:var(--primary)">${s.w} <span class="text-[10px] text-white opacity-50">KG</span></div><div class="font-bold opacity-60">${s.r} reps</div></div><button onclick="deleteItem('sport', ${s.id})" class="absolute left-0 top-0 w-full h-full bg-red-500/80 rounded-2xl hidden group-hover:flex items-center justify-center font-bold uppercase backdrop-blur-sm">Supprimer</button></div>`;
                } else {
                    return `<div class="card p-3 flex justify-between items-center text-xs border-orange-500/30 border relative group"><div><span class="font-black uppercase text-[10px] text-orange-400 block">Cardio</span><span class="font-bold uppercase text-sm">${s.name}</span></div><div class="text-right"><div class="font-black text-lg text-orange-400">${s.time} <span class="text-[10px] text-white opacity-50">MIN</span></div><div class="font-bold opacity-60">${s.dist} km</div></div><button onclick="deleteItem('sport', ${s.id})" class="absolute left-0 top-0 w-full h-full bg-red-500/80 rounded-2xl hidden group-hover:flex items-center justify-center font-bold uppercase backdrop-blur-sm">Supprimer</button></div>`;
                }
            }).join('');

            document.getElementById('list-food').innerHTML = dayFood.map(f => `
                <div class="card p-3 flex justify-between items-center text-xs relative group">
                    <span class="font-bold uppercase">${f.n}</span>
                    <div class="text-right flex gap-3"><span class="font-bold">${f.k} <span class="opacity-50 text-[8px]">KCAL</span></span><span class="font-bold text-emerald-400">${f.p}g <span class="opacity-50 text-[8px] text-white">PROT</span></span></div>
                    <button onclick="deleteItem('food', ${f.id})" class="absolute left-0 top-0 w-full h-full bg-red-500/80 rounded-2xl hidden group-hover:flex items-center justify-center font-bold uppercase backdrop-blur-sm">Supprimer</button>
                </div>`).join('');

            document.getElementById('list-body').innerHTML = userData.body.slice(0,5).map(b => `<div class="card p-3 text-xs"><div class="flex justify-between font-bold opacity-40 mb-2 text-[10px] uppercase"><span>${b.d}</span><span>‚öñÔ∏è ${b.w}kg</span></div>
                    <div class="grid grid-cols-4 gap-1 text-center"><div class="bg-white/5 p-1 rounded"><div class="opacity-50 text-[8px]">Taille</div><div class="font-bold">${b.waist}</div></div><div class="bg-white/5 p-1 rounded"><div class="opacity-50 text-[8px]">Hanches</div><div class="font-bold">${b.glutes}</div></div><div class="bg-white/5 p-1 rounded"><div class="opacity-50 text-[8px]">Bras</div><div class="font-bold">${b.arms}</div></div><div class="bg-white/5 p-1 rounded"><div class="opacity-50 text-[8px]">Cuisses</div><div class="font-bold">${b.thighs}</div></div></div></div>`).join('');
        }
        render();
    </script>
</body>
</html>
